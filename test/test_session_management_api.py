# coding: utf-8

"""
    iikoServer API

    API Server позволяет сделать интеграции, которые предназначены для работы с номенклатурой, отчетами, документами, данными сотрудников и приказами.   ### Ограничения и рекомендации - Запросы должны выполняться последовательно друг за другом - Запрашивайте данные за период не длиннее одного месяца, в идеале — за один день или неделю - Для OLAPv2-отчетов рекомендуется устанавливать build-summary=false - При построении OLAPv2-отчета рекомендуется использовать не более 7 полей - Перед выполнением запросов проверяйте их на демо сервере

    The version of the OpenAPI document: 1.0.0
    Generated by OpenAPI Generator (https://openapi-generator.tech)

    Do not edit the class manually.
"""  # noqa: E501


import asyncio
import unittest
import hashlib
import os

from iikoserver_client.api.session_management_api import SessionManagementApi
from iikoserver_client.configuration import Configuration
from iikoserver_client.api_client import ApiClient


class TestSessionManagementApi(unittest.IsolatedAsyncioTestCase):
    """SessionManagementApi unit test stubs"""

    async def asyncSetUp(self) -> None:
        # Read credentials from env variables or set them directly
        self.server_url = os.environ.get("IIKO_SERVER_URL", None)
        self.login = os.environ.get("IIKO_SERVER_LOGIN", None)  # Replace with your login
        self.password = os.environ.get("IIKO_SERVER_PASSWORD", None)  # Replace with your password
        self.password_hash = hashlib.sha1(self.password.encode()).hexdigest()
        
        # Create configuration
        self.config = Configuration(host=self.server_url, debug=True)
        
        # Create API client
        self.client = ApiClient(configuration=self.config)
        self.api = SessionManagementApi(api_client=self.client)

    async def asyncTearDown(self) -> None:
        # Ensure client is closed properly
        await self.client.close()
        
        # Give event loop time to cleanup resources
        await asyncio.sleep(0.1)

    async def test_auth_get(self) -> None:
        """Test case for auth_get

        Авторизация пользователя (GET)
        """
        try:
            # Call the API method
            response = await self.api.auth_get(login=self.login, var_pass=self.password_hash)
            
            # Add assertions
            self.assertIsNotNone(response)
            self.assertTrue(len(response) > 0)
            
            # Logout to clean up the session
            await self.api.logout_get()
        except Exception as e:
            self.fail(f"Auth GET test failed with error: {str(e)}")

    async def test_auth_post(self) -> None:
        """Test case for auth_post

        Авторизация пользователя (POST)
        """
        try:
            # Call the API method
            response = await self.api.auth_post(login=self.login, var_pass=self.password_hash)
            
            # Add assertions
            self.assertIsNotNone(response)
            self.assertTrue(len(response) > 0)
            
            # Logout to clean up the session
            await self.api.logout_post()
        except Exception as e:
            self.fail(f"Auth POST test failed with error: {str(e)}")

    async def test_logout_get(self) -> None:
        """Test case for logout_get

        Выход из системы (GET)
        """
        try:
            # First authenticate
            await self.api.auth_get(login=self.login, var_pass=self.password_hash)
            
            # Then logout
            response = await self.api.logout_get()
            
        except Exception as e:
            self.fail(f"Logout GET test failed with error: {str(e)}")

    async def test_logout_post(self) -> None:
        """Test case for logout_post

        Выход из системы (POST)
        """
        try:
            # First authenticate
            await self.api.auth_post(login=self.login, var_pass=self.password_hash)
            
            # Then logout
            response = await self.api.logout_post()
            
            # Verify response (logout typically returns empty string or None)
        except Exception as e:
            self.fail(f"Logout POST test failed with error: {str(e)}")


if __name__ == '__main__':
    unittest.main()
