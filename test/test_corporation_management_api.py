# coding: utf-8

"""
    iikoServer API

    API Server позволяет сделать интеграции, которые предназначены для работы с номенклатурой, отчетами, документами, данными сотрудников и приказами.   ### Ограничения и рекомендации - Запросы должны выполняться последовательно друг за другом - Запрашивайте данные за период не длиннее одного месяца, в идеале — за один день или неделю - Для OLAPv2-отчетов рекомендуется устанавливать build-summary=false - При построении OLAPv2-отчета рекомендуется использовать не более 7 полей - Перед выполнением запросов проверяйте их на демо сервере

    The version of the OpenAPI document: 1.0.0
    Generated by OpenAPI Generator (https://openapi-generator.tech)

    Do not edit the class manually.
"""  # noqa: E501


import hashlib
import os
import unittest
import asyncio
import json

from iikoserver_client.api.corporation_management_api import CorporationManagementApi
from iikoserver_client.api_client import ApiClient
from iikoserver_client.configuration import Configuration
from iikoserver_client.api.session_management_api import SessionManagementApi


class TestCorporationManagementApi(unittest.IsolatedAsyncioTestCase):
    """CorporationManagementApi unit test stubs"""

    async def asyncSetUp(self) -> None:
        # Read credentials from env variables or set them directly
        self.server_url = os.environ.get("IIKO_SERVER_URL", None)
        self.login = os.environ.get("IIKO_SERVER_LOGIN", None)  # Replace with your login
        self.password = os.environ.get("IIKO_SERVER_PASSWORD", None)  # Replace with your password
        self.password_hash = hashlib.sha1(self.password.encode()).hexdigest()
        
        # Create configuration
        self.config = Configuration(host=self.server_url, debug=True)
        
        # Create API client with context manager support
        self.client = ApiClient(configuration=self.config)
        self.session_api = SessionManagementApi(api_client=self.client)
        await self.session_api.auth_post(login=self.login, var_pass=self.password_hash)
        self.api = CorporationManagementApi(api_client=self.client)

    async def asyncTearDown(self) -> None:
        # Make sure to properly close all connections
        try:
            await self.session_api.logout_post()
        except Exception as e:
            print(f"Warning: logout failed: {e}")
        
        # Ensure client is closed properly
        await self.client.close()
        
        # Give event loop time to cleanup resources
        await asyncio.sleep(0.1)

    async def test_corporation_departments_get(self) -> None:
        """Test case for corporation_departments_get

        Иерархия подразделений
        """
        try:
            # Call the API method
            response = await self.api.corporation_departments_get()
            # Add assertions
            self.assertIsNotNone(response)
            self.assertTrue(len(response.corporate_item_dtoes) > 0)
            print(json.dumps(response.to_dict(), indent=4, ensure_ascii=False))
        except Exception as e:
            self.fail(f"Corporation departments GET test failed with error: {str(e)}")
    
    async def test_corporation_stores_get(self) -> None:
        """Test case for corporation_stores_get

        Список складов
        """
        try:
            # Call the API method
            response = await self.api.corporation_stores_get()
            # Add assertions
            self.assertIsNotNone(response)
            self.assertTrue(len(response.corporate_item_dtoes) > 0)
            print(json.dumps(response.to_dict(), indent=4, ensure_ascii=False))
        except Exception as e:
            self.fail(f"Corporation stores GET test failed with error: {str(e)}")

    async def test_corporation_groups_get(self) -> None:
        """Test case for corporation_groups_get

        Список групп и отделений
        """
        try:
            # Call the API method
            response = await self.api.corporation_groups_get()
            # Add assertions
            self.assertIsNotNone(response)
            self.assertTrue(len(response.group_dtoes) > 0)  
            print(json.dumps(response.to_dict(), indent=4, ensure_ascii=False))
        except Exception as e:
            self.fail(f"Corporation groups GET test failed with error: {str(e)}")

    async def test_corporation_terminals_get(self) -> None:
        """Test case for corporation_terminals_get

        Список терминалов
        """
        try:
            # Call the API method
            response = await self.api.corporation_terminals_get()
            # Add assertions
            self.assertIsNotNone(response)
            self.assertTrue(len(response.terminal_dtoes) > 0)
            print(json.dumps(response.to_dict(), indent=4, ensure_ascii=False))
        except Exception as e:
            self.fail(f"Corporation terminals GET test failed with error: {str(e)}")

    async def test_corporation_departments_search_get(self) -> None:
        """Test case for corporation_departments_search_get

        Поиск подразделений по коду
        """
        try:
            # Call the API method
            response = await self.api.corporation_departments_search_get(code="1")
            # Add assertions
            self.assertIsNotNone(response)
            self.assertTrue(response.corporate_item_dtoes is None or len(response.corporate_item_dtoes) > 0)
        except Exception as e:
            self.fail(f"Corporation departments search GET test failed with error: {str(e)}")

    async def test_corporation_stores_search_get(self) -> None:
        """Test case for corporation_stores_search_get

        Поиск складов по коду
        """
        try:
            # Call the API method
            response = await self.api.corporation_stores_search_get(code="1")
            # Add assertions
            self.assertIsNotNone(response)
            self.assertTrue(response.corporate_item_dtoes is None or len(response.corporate_item_dtoes) > 0)
        except Exception as e:
            self.fail(f"Corporation stores search GET test failed with error: {str(e)}")
    
    async def test_corporation_groups_search_get(self) -> None:
        """Test case for corporation_groups_search_get

        Поиск групп и отделений по коду
        """
        try:
            # Call the API method
            response = await self.api.corporation_groups_search_get(
                name="Ос",
            )
            # Add assertions
            self.assertIsNotNone(response)
            self.assertTrue(response.group_dtoes is None or len(response.group_dtoes) > 0)
        except Exception as e:
            self.fail(f"Corporation groups search GET test failed with error: {str(e)}")
    
    async def test_corporation_terminals_search_get(self) -> None:
        """Test case for corporation_terminals_search_get

        Поиск терминалов по коду
        """
        try:
            # Call the API method
            response = await self.api.corporation_terminals_search_get(
                name="37.202.8.28"
            )
            # Add assertions
            self.assertIsNotNone(response)
            self.assertTrue(response.terminal_dtoes is None or len(response.terminal_dtoes) > 0)
        except Exception as e:
            self.fail(f"Corporation terminals search GET test failed with error: {str(e)}")

    async def test_v2_corporation_settings_get(self) -> None:
        """Test case for v2_corporation_settings_get

        Получение настроек корпорации
        """
        try:
            # Call the API method
            response = await self.api.v2_corporation_settings_get()
            # Add assertions
            self.assertIsNotNone(response)
            self.assertTrue(response is not None)
        except Exception as e:
            self.fail(f"Corporation settings GET test failed with error: {str(e)}")
            
if __name__ == '__main__':
    unittest.main()
